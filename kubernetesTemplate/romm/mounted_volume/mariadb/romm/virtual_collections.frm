TYPE=VIEW
query=with genres as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`genre`) AS `collection_name`,\'genre\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.genres\'), \'$[*]\' COLUMNS (`genre` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.genres\') is not null), franchises as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`franchise`) AS `collection_name`,\'franchise\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.franchises\'), \'$[*]\' COLUMNS (`franchise` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.franchises\') is not null), collections as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`collection`) AS `collection_name`,\'collection\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.collections\'), \'$[*]\' COLUMNS (`collection` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.collections\') is not null), modes as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`mode`) AS `collection_name`,\'mode\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.game_modes\'), \'$[*]\' COLUMNS (`mode` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.game_modes\') is not null), companies as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`company`) AS `collection_name`,\'company\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.companies\'), \'$[*]\' COLUMNS (`company` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.companies\') is not null)select `combined`.`collection_name` AS `name`,`combined`.`collection_type` AS `type`,concat(\'Autogenerated \',`combined`.`collection_name`,\' collection\') AS `description`,current_timestamp() AS `created_at`,current_timestamp() AS `updated_at`,json_arrayagg(`combined`.`rom_id`) AS `rom_ids`,json_arrayagg(`combined`.`path_cover_s`) AS `path_covers_s`,json_arrayagg(`combined`.`path_cover_l`) AS `path_covers_l` from (select `genres`.`rom_id` AS `rom_id`,`genres`.`path_cover_s` AS `path_cover_s`,`genres`.`path_cover_l` AS `path_cover_l`,`genres`.`collection_name` AS `collection_name`,`genres`.`collection_type` AS `collection_type` from `genres` union all select `franchises`.`rom_id` AS `rom_id`,`franchises`.`path_cover_s` AS `path_cover_s`,`franchises`.`path_cover_l` AS `path_cover_l`,`franchises`.`collection_name` AS `collection_name`,`franchises`.`collection_type` AS `collection_type` from `franchises` union all select `collections`.`rom_id` AS `rom_id`,`collections`.`path_cover_s` AS `path_cover_s`,`collections`.`path_cover_l` AS `path_cover_l`,`collections`.`collection_name` AS `collection_name`,`collections`.`collection_type` AS `collection_type` from `collections` union all select `modes`.`rom_id` AS `rom_id`,`modes`.`path_cover_s` AS `path_cover_s`,`modes`.`path_cover_l` AS `path_cover_l`,`modes`.`collection_name` AS `collection_name`,`modes`.`collection_type` AS `collection_type` from `modes` union all select `companies`.`rom_id` AS `rom_id`,`companies`.`path_cover_s` AS `path_cover_s`,`companies`.`path_cover_l` AS `path_cover_l`,`companies`.`collection_name` AS `collection_name`,`companies`.`collection_type` AS `collection_type` from `companies`) `combined` group by `combined`.`collection_type`,`combined`.`collection_name` having count(distinct `combined`.`rom_id`) > 2 order by `combined`.`collection_type`,`combined`.`collection_name`
md5=8c4b929e9a8c3a7134b9fc1ca79a1826
updatable=0
algorithm=0
definer_user=romm
definer_host=%
suid=2
with_check_option=0
timestamp=0001748017179459747
create-version=2
source=WITH genres AS (\n                    SELECT\n                        r.id as rom_id,\n                        r.path_cover_s as path_cover_s,\n                        r.path_cover_l as path_cover_l,\n                        CONCAT(j.genre) as collection_name,\n                        \'genre\' as collection_type\n                    FROM\n                        roms r\n                        CROSS JOIN JSON_TABLE(\n                            JSON_EXTRACT(igdb_metadata, \'$.genres\'),\n                            \'$[*]\' COLUMNS (genre VARCHAR(255) PATH \'$\')\n                        ) j\n                    WHERE\n                        JSON_EXTRACT(igdb_metadata, \'$.genres\') IS NOT NULL\n                ),\n                franchises AS (\n                    SELECT\n                        r.id as rom_id,\n                        r.path_cover_s as path_cover_s,\n                        r.path_cover_l as path_cover_l,\n                        CONCAT(j.franchise) as collection_name,\n                        \'franchise\' as collection_type\n                    FROM\n                        roms r\n                        CROSS JOIN JSON_TABLE(\n                            JSON_EXTRACT(igdb_metadata, \'$.franchises\'),\n                            \'$[*]\' COLUMNS (franchise VARCHAR(255) PATH \'$\')\n                        ) j\n                    WHERE\n                        JSON_EXTRACT(igdb_metadata, \'$.franchises\') IS NOT NULL\n                ),\n                collections AS (\n                    SELECT\n                        r.id as rom_id,\n                        r.path_cover_s as path_cover_s,\n                        r.path_cover_l as path_cover_l,\n                        CONCAT(j.collection) as collection_name,\n                        \'collection\' as collection_type\n                    FROM\n                        roms r\n                        CROSS JOIN JSON_TABLE(\n                            JSON_EXTRACT(igdb_metadata, \'$.collections\'),\n                            \'$[*]\' COLUMNS (collection VARCHAR(255) PATH \'$\')\n                        ) j\n                    WHERE\n                        JSON_EXTRACT(igdb_metadata, \'$.collections\') IS NOT NULL\n                ),\n                modes AS (\n                    SELECT\n                        r.id as rom_id,\n                        r.path_cover_s as path_cover_s,\n                        r.path_cover_l as path_cover_l,\n                        CONCAT(j.mode) as collection_name,\n                        \'mode\' as collection_type\n                    FROM\n                        roms r\n                        CROSS JOIN JSON_TABLE(\n                            JSON_EXTRACT(igdb_metadata, \'$.game_modes\'),\n                            \'$[*]\' COLUMNS (mode VARCHAR(255) PATH \'$\')\n                        ) j\n                    WHERE\n                        JSON_EXTRACT(igdb_metadata, \'$.game_modes\') IS NOT NULL\n                ),\n                companies AS (\n                    SELECT\n                        r.id as rom_id,\n                        r.path_cover_s as path_cover_s,\n                        r.path_cover_l as path_cover_l,\n                        CONCAT(j.company) as collection_name,\n                        \'company\' as collection_type\n                    FROM\n                        roms r\n                        CROSS JOIN JSON_TABLE(\n                            JSON_EXTRACT(igdb_metadata, \'$.companies\'),\n                            \'$[*]\' COLUMNS (company VARCHAR(255) PATH \'$\')\n                        ) j\n                    WHERE\n                        JSON_EXTRACT(igdb_metadata, \'$.companies\') IS NOT NULL\n                )\n                SELECT\n                    collection_name as name,\n                    collection_type as type,\n                    CONCAT(\'Autogenerated \', collection_name, \' collection\') AS description,\n                    NOW() AS created_at,\n                    NOW() AS updated_at,\n                    JSON_ARRAYAGG(rom_id) as rom_ids,\n                    JSON_ARRAYAGG(path_cover_s) as path_covers_s,\n                    JSON_ARRAYAGG(path_cover_l) as path_covers_l\n                FROM\n                (\n                    SELECT * FROM genres\n                    UNION ALL\n                    SELECT * FROM franchises\n                    UNION ALL\n                    SELECT * FROM collections\n                    UNION ALL\n                    SELECT * FROM modes\n                    UNION ALL\n                    SELECT * FROM companies\n                ) combined\n                GROUP BY collection_type, collection_name\n                HAVING COUNT(DISTINCT rom_id) > 2\n                ORDER BY collection_type, collection_name
client_cs_name=utf8mb4
connection_cl_name=utf8mb4_uca1400_ai_ci
view_body_utf8=with genres as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`genre`) AS `collection_name`,\'genre\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.genres\'), \'$[*]\' COLUMNS (`genre` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.genres\') is not null), franchises as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`franchise`) AS `collection_name`,\'franchise\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.franchises\'), \'$[*]\' COLUMNS (`franchise` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.franchises\') is not null), collections as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`collection`) AS `collection_name`,\'collection\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.collections\'), \'$[*]\' COLUMNS (`collection` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.collections\') is not null), modes as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`mode`) AS `collection_name`,\'mode\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.game_modes\'), \'$[*]\' COLUMNS (`mode` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.game_modes\') is not null), companies as (select `r`.`id` AS `rom_id`,`r`.`path_cover_s` AS `path_cover_s`,`r`.`path_cover_l` AS `path_cover_l`,concat(`j`.`company`) AS `collection_name`,\'company\' AS `collection_type` from (`romm`.`roms` `r` join JSON_TABLE(json_extract(`r`.`igdb_metadata`,\'$.companies\'), \'$[*]\' COLUMNS (`company` varchar(255) PATH \'$\')) `j`) where json_extract(`r`.`igdb_metadata`,\'$.companies\') is not null)select `combined`.`collection_name` AS `name`,`combined`.`collection_type` AS `type`,concat(\'Autogenerated \',`combined`.`collection_name`,\' collection\') AS `description`,current_timestamp() AS `created_at`,current_timestamp() AS `updated_at`,json_arrayagg(`combined`.`rom_id`) AS `rom_ids`,json_arrayagg(`combined`.`path_cover_s`) AS `path_covers_s`,json_arrayagg(`combined`.`path_cover_l`) AS `path_covers_l` from (select `genres`.`rom_id` AS `rom_id`,`genres`.`path_cover_s` AS `path_cover_s`,`genres`.`path_cover_l` AS `path_cover_l`,`genres`.`collection_name` AS `collection_name`,`genres`.`collection_type` AS `collection_type` from `genres` union all select `franchises`.`rom_id` AS `rom_id`,`franchises`.`path_cover_s` AS `path_cover_s`,`franchises`.`path_cover_l` AS `path_cover_l`,`franchises`.`collection_name` AS `collection_name`,`franchises`.`collection_type` AS `collection_type` from `franchises` union all select `collections`.`rom_id` AS `rom_id`,`collections`.`path_cover_s` AS `path_cover_s`,`collections`.`path_cover_l` AS `path_cover_l`,`collections`.`collection_name` AS `collection_name`,`collections`.`collection_type` AS `collection_type` from `collections` union all select `modes`.`rom_id` AS `rom_id`,`modes`.`path_cover_s` AS `path_cover_s`,`modes`.`path_cover_l` AS `path_cover_l`,`modes`.`collection_name` AS `collection_name`,`modes`.`collection_type` AS `collection_type` from `modes` union all select `companies`.`rom_id` AS `rom_id`,`companies`.`path_cover_s` AS `path_cover_s`,`companies`.`path_cover_l` AS `path_cover_l`,`companies`.`collection_name` AS `collection_name`,`companies`.`collection_type` AS `collection_type` from `companies`) `combined` group by `combined`.`collection_type`,`combined`.`collection_name` having count(distinct `combined`.`rom_id`) > 2 order by `combined`.`collection_type`,`combined`.`collection_name`
mariadb-version=110702
